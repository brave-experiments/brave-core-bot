#!/bin/bash
# Pre-commit hook for brave-core-bot repository
# Prevents committing runtime state files that are in .gitignore

# Check if any staged files are in .gitignore
STAGED_FILES=$(git diff --cached --name-only)

if [ -z "$STAGED_FILES" ]; then
  exit 0
fi

# Hardcoded list of runtime files that should never be committed
NEVER_COMMIT=(
  "prd.json"
  "progress.txt"
  "run-state.json"
)

# Check each staged file against the never-commit list
BLOCKED_FILES=""
for file in $STAGED_FILES; do
  for blocked in "${NEVER_COMMIT[@]}"; do
    if [ "$file" == "$blocked" ]; then
      BLOCKED_FILES="$BLOCKED_FILES\n  - $file"
      break
    fi
  done
done

if [ -n "$BLOCKED_FILES" ]; then
  echo "‚ùå ERROR: Attempting to commit runtime state files:"
  echo -e "$BLOCKED_FILES"
  echo ""
  echo "These files should not be committed (they are in .gitignore)."
  echo "To unstage them, run:"
  echo "  git reset HEAD <file>"
  echo ""
  exit 1
fi

exit 0
